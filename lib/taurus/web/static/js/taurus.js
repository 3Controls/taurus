// Generated by CoffeeScript 1.3.3
(function() {
  var initialize_taurus, initialize_taurus_com;
  var taurus_element, taurus_models, taurus_websocket;
 
  taurus_websocket = null;
  taurus_onmessage_callbacks = $.Callbacks();
  
  taurus_models = function() {
    var elem, _i, _len, _ref, _results;
    _ref = $('[data-taurus-model]');
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      elem = _ref[_i];
      _results.push(elem.dataset['taurusModel']);
    }
    return _results;
  };

  taurus_element = function(model) {
    return $('[data-taurus-model="' + model + '"]');
  };

  taurus_ws_onmessage = function(event_data) {
    var elements;
    elements = taurus_element(event_data.model);
    return elements.css(event_data.css).html(event_data.html);
  };
  
  initialize_taurus = function() {
    console.log("Initializing taurus page...");

    taurus_onmessage_callbacks.add(taurus_ws_onmessage);

    host = "160.103.207.112"
    port = 8888
    ws_id = "/taurus"
    ws_addr = "ws://" + host + ":" + port + ws_id
    
    console.log("Creating WebSocket on " + ws_addr)
    
    taurus_websocket = new WebSocket(ws_addr);
    
    taurus_websocket.onopen = function() {
      console.log("WebSocket connected");
      return initialize_taurus_com();
    };
    
    taurus_websocket.onmessage = function(event) {
      event_data = JSON.parse(event.data);
      return taurus_onmessage_callbacks.fire(event_data);
    };
    
    taurus_websocket.onerror = function(event) {
      return $('body').append('<div>Error:' + event + ' ' + '</div>');
    };
    
    taurus_websocket.onclose = function(event) {
      console.log("WebSocket DISCONNECTED");
    };
    
    return console.log("Finished initializing taurus page");
  };
  
  initialize_taurus_com = function() {
    var json_models, models;
    console.log("Registering taurus models...");
    models = taurus_models();
    json_models = JSON.stringify({
      models: models
    });
    taurus_websocket.send(json_models);
    return console.log("Finished registering taurus models");
  };

  $(function() {
    return initialize_taurus();
  });

}).call(this);
